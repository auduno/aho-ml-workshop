<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>ML5js YOLO video example</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <script src='https://unpkg.com/ml5@0.4.1/dist/ml5.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
</head>
<body>
    <div id='container'>
        <h1>Video Classifier Example</h1>
        <p id='result'>Loading model...</p>
    </div>
    <script>
        let yolo;
        let video;
        let objects = [];

        function setup() {
            createCanvas(640, 480);
            video = createCapture(VIDEO);
            video.size(640, 480);

            yolo = ml5.YOLO(video, {filterBoxesThreshold: 0.01, IOUThreshold: 0.4, classProbThreshold: 0.4}, modelReady);
            document.getElementById('result').textContent = 'Loading model...'

            video.hide();
        }

        function modelReady() {
            document.getElementById('result').textContent = 'Model ready!';
            detectVideo();
        }

        function detectVideo() {
            yolo.detect(function(err, results) {
                objects = results;
                detectVideo();
            });
        }

        function draw() {
            image(video, 0, 0, width, height);
            for (let i = 0; i < objects.length; i++) {
                noStroke();
                fill(0, 255, 0);
                text(objects[i].label, objects[i].x * width, objects[i].y * height - 5);
                noFill();
                strokeWeight(4);
                stroke(0, 255, 0);
                rect(objects[i].x * width, objects[i].y * height, objects[i].w * width, objects[i].h * height);
            }
        }
    </script>
</body>
</html>